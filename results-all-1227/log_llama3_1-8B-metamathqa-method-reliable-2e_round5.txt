================================================================================
Ê≠£Âú®Âä†ËΩΩÊ®°ÂûãÔºàÂ∞ÜÁî®‰∫éÊâÄÊúâÊï∞ÊçÆÈõÜÔºâ...
================================================================================
Ê≠£Âú®Âä†ËΩΩÊ®°Âûã: /volume/data/lzh/Pai-Megatron-Patch-main/qwen-exp-ckpts/llama3_1-8B-metamathqa-method-reliable-2e
‰ΩøÁî® GPU: 0 (1 ‰∏™GPU)
Tensor Âπ∂Ë°åÂ§ßÂ∞è: 1
Ê£ÄÊµãÂà∞ chat templateÔºåÂ∞Ü‰ΩøÁî® ChatML Ê†ºÂºè
INFO 12-27 16:41:36 [utils.py:253] non-default args: {'trust_remote_code': True, 'max_model_len': 4096, 'gpu_memory_utilization': 0.95, 'max_num_batched_tokens': 65536, 'max_num_seqs': 2048, 'disable_log_stats': True, 'enable_chunked_prefill': True, 'model': '/volume/data/lzh/Pai-Megatron-Patch-main/qwen-exp-ckpts/llama3_1-8B-metamathqa-method-reliable-2e'}
The argument `trust_remote_code` is to be used with Auto classes. It has no effect here and is ignored.
INFO 12-27 16:41:36 [model.py:514] Resolved architecture: LlamaForCausalLM
INFO 12-27 16:41:36 [model.py:1661] Using max model len 4096
INFO 12-27 16:41:37 [scheduler.py:230] Chunked prefill is enabled with max_num_batched_tokens=65536.
[0;36m(EngineCore_DP0 pid=438724)[0;0m INFO 12-27 16:41:37 [core.py:93] Initializing a V1 LLM engine (v0.13.0) with config: model='/volume/data/lzh/Pai-Megatron-Patch-main/qwen-exp-ckpts/llama3_1-8B-metamathqa-method-reliable-2e', speculative_config=None, tokenizer='/volume/data/lzh/Pai-Megatron-Patch-main/qwen-exp-ckpts/llama3_1-8B-metamathqa-method-reliable-2e', skip_tokenizer_init=False, tokenizer_mode=auto, revision=None, tokenizer_revision=None, trust_remote_code=True, dtype=torch.bfloat16, max_seq_len=4096, download_dir=None, load_format=auto, tensor_parallel_size=1, pipeline_parallel_size=1, data_parallel_size=1, disable_custom_all_reduce=False, quantization=None, enforce_eager=False, kv_cache_dtype=auto, device_config=cuda, structured_outputs_config=StructuredOutputsConfig(backend='auto', disable_fallback=False, disable_any_whitespace=False, disable_additional_properties=False, reasoning_parser='', reasoning_parser_plugin='', enable_in_reasoning=False), observability_config=ObservabilityConfig(show_hidden_metrics_for_version=None, otlp_traces_endpoint=None, collect_detailed_traces=None, kv_cache_metrics=False, kv_cache_metrics_sample=0.01, cudagraph_metrics=False, enable_layerwise_nvtx_tracing=False), seed=0, served_model_name=/volume/data/lzh/Pai-Megatron-Patch-main/qwen-exp-ckpts/llama3_1-8B-metamathqa-method-reliable-2e, enable_prefix_caching=True, enable_chunked_prefill=True, pooler_config=None, compilation_config={'level': None, 'mode': <CompilationMode.VLLM_COMPILE: 3>, 'debug_dump_path': None, 'cache_dir': '', 'compile_cache_save_format': 'binary', 'backend': 'inductor', 'custom_ops': ['none'], 'splitting_ops': ['vllm::unified_attention', 'vllm::unified_attention_with_output', 'vllm::unified_mla_attention', 'vllm::unified_mla_attention_with_output', 'vllm::mamba_mixer2', 'vllm::mamba_mixer', 'vllm::short_conv', 'vllm::linear_attention', 'vllm::plamo2_mamba_mixer', 'vllm::gdn_attention_core', 'vllm::kda_attention', 'vllm::sparse_attn_indexer'], 'compile_mm_encoder': False, 'compile_sizes': [], 'compile_ranges_split_points': [65536], 'inductor_compile_config': {'enable_auto_functionalized_v2': False, 'combo_kernels': True, 'benchmark_combo_kernel': True}, 'inductor_passes': {}, 'cudagraph_mode': <CUDAGraphMode.FULL_AND_PIECEWISE: (2, 1)>, 'cudagraph_num_of_warmups': 1, 'cudagraph_capture_sizes': [1, 2, 4, 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96, 104, 112, 120, 128, 136, 144, 152, 160, 168, 176, 184, 192, 200, 208, 216, 224, 232, 240, 248, 256, 272, 288, 304, 320, 336, 352, 368, 384, 400, 416, 432, 448, 464, 480, 496, 512], 'cudagraph_copy_inputs': False, 'cudagraph_specialize_lora': True, 'use_inductor_graph_partition': False, 'pass_config': {'fuse_norm_quant': False, 'fuse_act_quant': False, 'fuse_attn_quant': False, 'eliminate_noops': True, 'enable_sp': False, 'fuse_gemm_comms': False, 'fuse_allreduce_rms': False}, 'max_cudagraph_capture_size': 512, 'dynamic_shapes_config': {'type': <DynamicShapesType.BACKED: 'backed'>, 'evaluate_guards': False}, 'local_cache_dir': None}
[0;36m(EngineCore_DP0 pid=438724)[0;0m INFO 12-27 16:41:45 [parallel_state.py:1203] world_size=1 rank=0 local_rank=0 distributed_init_method=tcp://172.16.70.168:34455 backend=nccl
[0;36m(EngineCore_DP0 pid=438724)[0;0m INFO 12-27 16:41:45 [parallel_state.py:1411] rank 0 in world size 1 is assigned as DP rank 0, PP rank 0, PCP rank 0, TP rank 0, EP rank 0
[0;36m(EngineCore_DP0 pid=438724)[0;0m INFO 12-27 16:41:46 [gpu_model_runner.py:3562] Starting to load model /volume/data/lzh/Pai-Megatron-Patch-main/qwen-exp-ckpts/llama3_1-8B-metamathqa-method-reliable-2e...
[0;36m(EngineCore_DP0 pid=438724)[0;0m INFO 12-27 16:41:46 [cuda.py:351] Using FLASH_ATTN attention backend out of potential backends: ('FLASH_ATTN', 'FLASHINFER', 'TRITON_ATTN', 'FLEX_ATTENTION')
[0;36m(EngineCore_DP0 pid=438724)[0;0m Loading safetensors checkpoint shards:   0% Completed | 0/2 [00:00<?, ?it/s]
[0;36m(EngineCore_DP0 pid=438724)[0;0m Loading safetensors checkpoint shards:  50% Completed | 1/2 [00:24<00:24, 24.84s/it]
[0;36m(EngineCore_DP0 pid=438724)[0;0m Loading safetensors checkpoint shards: 100% Completed | 2/2 [00:58<00:00, 29.78s/it]
[0;36m(EngineCore_DP0 pid=438724)[0;0m Loading safetensors checkpoint shards: 100% Completed | 2/2 [00:58<00:00, 29.04s/it]
[0;36m(EngineCore_DP0 pid=438724)[0;0m 
[0;36m(EngineCore_DP0 pid=438724)[0;0m INFO 12-27 16:42:45 [default_loader.py:308] Loading weights took 58.56 seconds
[0;36m(EngineCore_DP0 pid=438724)[0;0m INFO 12-27 16:42:46 [gpu_model_runner.py:3659] Model loading took 14.9889 GiB memory and 58.981432 seconds
[0;36m(EngineCore_DP0 pid=438724)[0;0m INFO 12-27 16:42:50 [backends.py:643] Using cache directory: /root/.cache/vllm/torch_compile_cache/4a982cb45d/rank_0_0/backbone for vLLM's torch.compile
[0;36m(EngineCore_DP0 pid=438724)[0;0m INFO 12-27 16:42:50 [backends.py:703] Dynamo bytecode transform time: 4.50 s
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866] EngineCore failed to start.
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866] Traceback (most recent call last):
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core.py", line 857, in run_engine_core
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     engine_core = EngineCoreProc(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core.py", line 637, in __init__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     super().__init__(
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core.py", line 109, in __init__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     num_gpu_blocks, num_cpu_blocks, kv_cache_config = self._initialize_kv_caches(
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core.py", line 240, in _initialize_kv_caches
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     available_gpu_memory = self.model_executor.determine_available_memory()
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/executor/abstract.py", line 126, in determine_available_memory
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return self.collective_rpc("determine_available_memory")
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/executor/uniproc_executor.py", line 75, in collective_rpc
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     result = run_method(self.driver_worker, method, args, kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/serial_utils.py", line 461, in run_method
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return func(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 120, in decorate_context
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return func(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/worker/gpu_worker.py", line 340, in determine_available_memory
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     self.model_runner.profile_run()
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/worker/gpu_model_runner.py", line 4474, in profile_run
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     hidden_states, last_hidden_states = self._dummy_run(
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 120, in decorate_context
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return func(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/worker/gpu_model_runner.py", line 4198, in _dummy_run
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     outputs = self.model(
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/cuda_graph.py", line 220, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return self.runnable(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return self._call_impl(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return forward_call(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/model_executor/models/llama.py", line 623, in forward
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     model_output = self.model(
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/decorators.py", line 526, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     output = TorchCompileWithNoGuardsWrapper.__call__(self, *args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/wrapper.py", line 218, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return self._call_with_optional_nvtx_range(
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/wrapper.py", line 109, in _call_with_optional_nvtx_range
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return callable_fn(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 832, in compile_wrapper
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return fn(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/model_executor/models/llama.py", line 412, in forward
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     def forward(
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 1044, in _fn
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return fn(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/caching.py", line 54, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return self.optimized_call(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/fx/graph_module.py", line 837, in call_wrapped
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return self._wrapped_call(self, *args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/fx/graph_module.py", line 413, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     raise e
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/fx/graph_module.py", line 400, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return super(self.cls, obj).__call__(*args, **kwargs)  # type: ignore[misc]
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return self._call_impl(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return forward_call(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "<eval_with_key>.66", line 209, in forward
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     submod_2 = self.submod_2(getitem_3, s72, l_self_modules_layers_modules_0_modules_self_attn_modules_o_proj_parameters_weight_, l_self_modules_layers_modules_0_modules_post_attention_layernorm_parameters_weight_, getitem_4, l_self_modules_layers_modules_0_modules_mlp_modules_gate_up_proj_parameters_weight_, l_self_modules_layers_modules_0_modules_mlp_modules_down_proj_parameters_weight_, l_self_modules_layers_modules_1_modules_input_layernorm_parameters_weight_, l_self_modules_layers_modules_1_modules_self_attn_modules_qkv_proj_parameters_weight_, l_positions_, l_self_modules_layers_modules_0_modules_self_attn_modules_rotary_emb_buffers_cos_sin_cache_);  getitem_3 = l_self_modules_layers_modules_0_modules_self_attn_modules_o_proj_parameters_weight_ = l_self_modules_layers_modules_0_modules_post_attention_layernorm_parameters_weight_ = getitem_4 = l_self_modules_layers_modules_0_modules_mlp_modules_gate_up_proj_parameters_weight_ = l_self_modules_layers_modules_0_modules_mlp_modules_down_proj_parameters_weight_ = l_self_modules_layers_modules_1_modules_input_layernorm_parameters_weight_ = l_self_modules_layers_modules_1_modules_self_attn_modules_qkv_proj_parameters_weight_ = None
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/cuda_graph.py", line 220, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return self.runnable(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/piecewise_backend.py", line 178, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return range_entry.runnable(*args)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/compiler_interface.py", line 268, in compiled_graph_wrapper
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     graph_output = inductor_compiled_graph(*args)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_inductor/standalone_compile.py", line 63, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return self._compiled_fn(*args)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_inductor/standalone_compile.py", line 184, in <lambda>
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return CompiledArtifact(lambda *args: compiled_fn(list(args)), None)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_functorch/_aot_autograd/runtime_wrappers.py", line 353, in runtime_wrapper
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     all_outs = call_func_at_runtime_with_args(
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_functorch/_aot_autograd/utils.py", line 129, in call_func_at_runtime_with_args
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     out = normalize_as_list(f(args))
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_functorch/_aot_autograd/runtime_wrappers.py", line 526, in wrapper
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return compiled_fn(runtime_args)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_inductor/output_code.py", line 613, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     return self.current_callable(inputs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_inductor/utils.py", line 2962, in run
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     out = model(new_inputs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]   File "/tmp/torchinductor_root/3g/c3g3ft5txxezgu6k3cz7lp5zjmrtm2urfvxt6wntud7ccgq26475.py", line 1026, in call
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866]     buf3 = empty_strided_cuda((s72, 28672), (28672, 1), torch.bfloat16)
[0;36m(EngineCore_DP0 pid=438724)[0;0m ERROR 12-27 16:42:53 [core.py:866] torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 3.50 GiB. GPU 0 has a total capacity of 139.81 GiB of which 496.44 MiB is free. Including non-PyTorch memory, this process has 18.54 GiB memory in use. Process 438793 has 120.78 GiB memory in use. Of the allocated memory 17.52 GiB is allocated by PyTorch, and 291.97 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
[0;36m(EngineCore_DP0 pid=438724)[0;0m Process EngineCore_DP0:
[0;36m(EngineCore_DP0 pid=438724)[0;0m Traceback (most recent call last):
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
[0;36m(EngineCore_DP0 pid=438724)[0;0m     self.run()
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/multiprocessing/process.py", line 108, in run
[0;36m(EngineCore_DP0 pid=438724)[0;0m     self._target(*self._args, **self._kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core.py", line 870, in run_engine_core
[0;36m(EngineCore_DP0 pid=438724)[0;0m     raise e
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core.py", line 857, in run_engine_core
[0;36m(EngineCore_DP0 pid=438724)[0;0m     engine_core = EngineCoreProc(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core.py", line 637, in __init__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     super().__init__(
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core.py", line 109, in __init__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     num_gpu_blocks, num_cpu_blocks, kv_cache_config = self._initialize_kv_caches(
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core.py", line 240, in _initialize_kv_caches
[0;36m(EngineCore_DP0 pid=438724)[0;0m     available_gpu_memory = self.model_executor.determine_available_memory()
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/executor/abstract.py", line 126, in determine_available_memory
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return self.collective_rpc("determine_available_memory")
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/executor/uniproc_executor.py", line 75, in collective_rpc
[0;36m(EngineCore_DP0 pid=438724)[0;0m     result = run_method(self.driver_worker, method, args, kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/serial_utils.py", line 461, in run_method
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return func(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 120, in decorate_context
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return func(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/worker/gpu_worker.py", line 340, in determine_available_memory
[0;36m(EngineCore_DP0 pid=438724)[0;0m     self.model_runner.profile_run()
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/worker/gpu_model_runner.py", line 4474, in profile_run
[0;36m(EngineCore_DP0 pid=438724)[0;0m     hidden_states, last_hidden_states = self._dummy_run(
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 120, in decorate_context
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return func(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/worker/gpu_model_runner.py", line 4198, in _dummy_run
[0;36m(EngineCore_DP0 pid=438724)[0;0m     outputs = self.model(
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/cuda_graph.py", line 220, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return self.runnable(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return self._call_impl(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return forward_call(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/model_executor/models/llama.py", line 623, in forward
[0;36m(EngineCore_DP0 pid=438724)[0;0m     model_output = self.model(
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/decorators.py", line 526, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     output = TorchCompileWithNoGuardsWrapper.__call__(self, *args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/wrapper.py", line 218, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return self._call_with_optional_nvtx_range(
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/wrapper.py", line 109, in _call_with_optional_nvtx_range
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return callable_fn(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 832, in compile_wrapper
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return fn(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/model_executor/models/llama.py", line 412, in forward
[0;36m(EngineCore_DP0 pid=438724)[0;0m     def forward(
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 1044, in _fn
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return fn(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/caching.py", line 54, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return self.optimized_call(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/fx/graph_module.py", line 837, in call_wrapped
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return self._wrapped_call(self, *args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/fx/graph_module.py", line 413, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     raise e
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/fx/graph_module.py", line 400, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return super(self.cls, obj).__call__(*args, **kwargs)  # type: ignore[misc]
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return self._call_impl(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return forward_call(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "<eval_with_key>.66", line 209, in forward
[0;36m(EngineCore_DP0 pid=438724)[0;0m     submod_2 = self.submod_2(getitem_3, s72, l_self_modules_layers_modules_0_modules_self_attn_modules_o_proj_parameters_weight_, l_self_modules_layers_modules_0_modules_post_attention_layernorm_parameters_weight_, getitem_4, l_self_modules_layers_modules_0_modules_mlp_modules_gate_up_proj_parameters_weight_, l_self_modules_layers_modules_0_modules_mlp_modules_down_proj_parameters_weight_, l_self_modules_layers_modules_1_modules_input_layernorm_parameters_weight_, l_self_modules_layers_modules_1_modules_self_attn_modules_qkv_proj_parameters_weight_, l_positions_, l_self_modules_layers_modules_0_modules_self_attn_modules_rotary_emb_buffers_cos_sin_cache_);  getitem_3 = l_self_modules_layers_modules_0_modules_self_attn_modules_o_proj_parameters_weight_ = l_self_modules_layers_modules_0_modules_post_attention_layernorm_parameters_weight_ = getitem_4 = l_self_modules_layers_modules_0_modules_mlp_modules_gate_up_proj_parameters_weight_ = l_self_modules_layers_modules_0_modules_mlp_modules_down_proj_parameters_weight_ = l_self_modules_layers_modules_1_modules_input_layernorm_parameters_weight_ = l_self_modules_layers_modules_1_modules_self_attn_modules_qkv_proj_parameters_weight_ = None
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/cuda_graph.py", line 220, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return self.runnable(*args, **kwargs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/piecewise_backend.py", line 178, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return range_entry.runnable(*args)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/compilation/compiler_interface.py", line 268, in compiled_graph_wrapper
[0;36m(EngineCore_DP0 pid=438724)[0;0m     graph_output = inductor_compiled_graph(*args)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_inductor/standalone_compile.py", line 63, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return self._compiled_fn(*args)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_inductor/standalone_compile.py", line 184, in <lambda>
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return CompiledArtifact(lambda *args: compiled_fn(list(args)), None)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_functorch/_aot_autograd/runtime_wrappers.py", line 353, in runtime_wrapper
[0;36m(EngineCore_DP0 pid=438724)[0;0m     all_outs = call_func_at_runtime_with_args(
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_functorch/_aot_autograd/utils.py", line 129, in call_func_at_runtime_with_args
[0;36m(EngineCore_DP0 pid=438724)[0;0m     out = normalize_as_list(f(args))
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_functorch/_aot_autograd/runtime_wrappers.py", line 526, in wrapper
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return compiled_fn(runtime_args)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_inductor/output_code.py", line 613, in __call__
[0;36m(EngineCore_DP0 pid=438724)[0;0m     return self.current_callable(inputs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/torch/_inductor/utils.py", line 2962, in run
[0;36m(EngineCore_DP0 pid=438724)[0;0m     out = model(new_inputs)
[0;36m(EngineCore_DP0 pid=438724)[0;0m   File "/tmp/torchinductor_root/3g/c3g3ft5txxezgu6k3cz7lp5zjmrtm2urfvxt6wntud7ccgq26475.py", line 1026, in call
[0;36m(EngineCore_DP0 pid=438724)[0;0m     buf3 = empty_strided_cuda((s72, 28672), (28672, 1), torch.bfloat16)
[0;36m(EngineCore_DP0 pid=438724)[0;0m torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 3.50 GiB. GPU 0 has a total capacity of 139.81 GiB of which 496.44 MiB is free. Including non-PyTorch memory, this process has 18.54 GiB memory in use. Process 438793 has 120.78 GiB memory in use. Of the allocated memory 17.52 GiB is allocated by PyTorch, and 291.97 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Traceback (most recent call last):
  File "/volume/data/rhjiang/math_evaluator/run_eval.py", line 316, in <module>
    main()
  File "/volume/data/rhjiang/math_evaluator/run_eval.py", line 260, in main
    vllm_client_obj = VLLMClient(
  File "/volume/data/rhjiang/math_evaluator/evaluators/vllm_client.py", line 68, in __init__
    self.llm = LLM(
  File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/entrypoints/llm.py", line 351, in __init__
    self.llm_engine = LLMEngine.from_engine_args(
  File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/llm_engine.py", line 183, in from_engine_args
    return cls(
  File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/llm_engine.py", line 109, in __init__
    self.engine_core = EngineCoreClient.make_client(
  File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core_client.py", line 93, in make_client
    return SyncMPClient(vllm_config, executor_class, log_stats)
  File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core_client.py", line 648, in __init__
    super().__init__(
  File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/core_client.py", line 477, in __init__
    with launch_core_engines(vllm_config, executor_class, log_stats) as (
  File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/contextlib.py", line 142, in __exit__
    next(self.gen)
  File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/utils.py", line 903, in launch_core_engines
    wait_for_engine_startup(
  File "/volume/data/rhjiang/miniconda3/envs/math/lib/python3.10/site-packages/vllm/v1/engine/utils.py", line 960, in wait_for_engine_startup
    raise RuntimeError(
RuntimeError: Engine core initialization failed. See root cause above. Failed core proc(s): {}
